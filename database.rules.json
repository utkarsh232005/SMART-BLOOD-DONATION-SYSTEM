{
  "rules": {
    ".read": false,
    ".write": false,
    
    "users": {
      "$userId": {
        ".read": "auth !== null && auth.uid === $userId",
        
        "name": {
          ".read": "auth !== null"
        },
        "bloodType": {
          ".read": "auth !== null"
        },
        "online": {
          ".read": "auth !== null"
        },
        "lastActive": {
          ".read": "auth !== null"
        },
        
        ".write": "auth !== null && auth.uid === $userId"
      }
    },
    
    "bloodGroups": {
      "$bloodType": {
        ".read": "auth !== null",
        
        "$userId": {
          ".write": "auth !== null && auth.uid === $userId"
        }
      }
    },
    
    "requests": {
      ".read": "auth !== null",
      
      "$requestId": {
        ".write": "auth !== null && (data.child('userId').val() === auth.uid || newData.child('userId').val() === auth.uid)",
        
        "status": {
          ".write": "auth !== null && data.val() === 'pending' && newData.val() === 'accepted'"
        },
        
        "donorId": {
          ".write": "auth !== null && data.parent().child('status').val() === 'pending' && newData.parent().child('status').val() === 'accepted' && newData.val() === auth.uid"
        },
        
        "acceptedAt": {
          ".write": "auth !== null && data.parent().child('status').val() === 'pending' && newData.parent().child('status').val() === 'accepted'"
        }
      }
    },
    
    "notifications": {
      "$userId": {
        ".read": "auth !== null && auth.uid === $userId",
        ".write": "auth !== null && auth.uid === $userId",
        
        "$notificationId": {
          ".write": "auth !== null"
        }
      }
    },
    
    "chatRooms": {
      "$roomId": {
        ".read": "auth !== null && (data.child('participants').hasChild(auth.uid) || newData.child('participants').hasChild(auth.uid))",
        ".write": "auth !== null && (data.child('participants').hasChild(auth.uid) || newData.child('participants').hasChild(auth.uid))",
        
        "messages": {
          "$messageId": {
            ".validate": "newData.child('senderId').val() === auth.uid || data.child('senderId').val() === auth.uid"
          }
        }
      }
    }
  }
}
